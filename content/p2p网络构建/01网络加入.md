[toc]

# 网络加入

P2P网络中的设备通常位于不同的私有网络中，这些网络使用NAT技术，导致设备无法直接通过公网IP相互访问。为了能让它们直接连接，需要[信令服务器](https://github.com/a-wing/webrtc-book-cn/blob/master/04_the-need-for-a-signaling-channel.md)帮助设备交换网络信息(如IP地址和端口)。

## 方案1 时间分块动态种子节点

使用peerjs连接客户端，客户端在初始化时，生成一个唯一的peerid。当要连接到其他客户端时，只需要拿到目标客户端的peerid，就可以从信令服务器中检索出对应的信息，从而连接到目标客户端。

为了网络的健壮性，也因为经济因素，这个方案的peerid管理不依赖于信令服务器，而是通过每个客户端通过算法，计算出网络中存在的某个节点，通过那个节点来加入网络中。

本方案的核心是，每经过一段时间，利用当前计算出一个peerid，当客户端初始化时，先尝试连接这个peerid，如果peerid不存在，就成为这个peerid。这个peerid对应的节点称为种子节点，每个时间段由若干个种子节点进行管理，当种子节点连接数到达一定数量后，将根据节点状态，动态选举出一个新的种子节点，旧的种子节点会把种子节点的身份移交给新的种子节点。在当前时间段快要结束时，通过同样的选举方式，选举出新的时间块的种子节点，并与新的种子节点连接。